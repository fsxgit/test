<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1" />
    <title>方球</title>
    <link  rel="icon" type="image/x-icon" href="./images/favicon.ico">
    <link rel="stylesheet" href="css/base.css"/>
    <link rel="stylesheet" href="css/style.css"/>
</head>
<body>
<div class="circle_header">币榜热圈</div>
<div class="circle_box">
    <ul id="data_circle_list">
        <div class="requestLoadingTs">正在请求币榜热圈信息...</div>
        <!--<li class="main oh">-->
            <!--<a href="group.html">-->
            <!--<div class="circle_center">-->
                <!--<div class="circle_left fl">-->
                    <!--<div class="img"><img src="images/photo.jpg" alt=""/></div>-->
                    <!--<div class="name">清风明月...</div>-->
                    <!--<div class="lord">圈主</div>-->
                <!--</div>-->
                <!--<div class="circle_right">-->
                    <!--<p class="tit">联邦社区圈子...</p>-->
                    <!--<p class="time"><span>2018-04-19</span><span>7人</span></p>-->
                    <!--<p class="txt">各类白皮书、行业应用报告、区块链峰会、数字货币分析等最新动态的共享圈！欢迎加入我们。</p>-->
                <!--</div>-->
            <!--</div>-->
            <!--</a>-->
        <!--</li>-->
    </ul>
    <p class="loadMore">点击加载更多...</p>
</div>

<div id="footer">
    <ul>
        <li><a href="index.html"><div class="my">我的方球</div></a></li>
        <li><a href="bar.html"><div class="bar">币吧</div></a></li>
        <li><a href="circle.html"><div class="circle active">币圈</div></a></li>
    </ul>
</div>
<script src="js/jquery.min.js"></script>
<script src="js/js.js"></script>
<script>
    var last_id = "";
    /**
     * 获取我加入的圈子列表
     * state为0时，证明是进入页面时请求数据
     *      为1时，证明是点击加载更多请求的数据
     * lastId：加载更多时传的上次请求的最后一个id
     * */
    circleLoad("0","");
    function circleLoad(state,lastId){
        loading("1","");
        var URL = "";
        if(state == 0){
            URL = PORT_CONNECT+"/api/v1/circle";
        }else{
            URL = PORT_CONNECT+"/api/v1/circle?last_id="+lastId;
        }
        $.ajax({
            headers: {
                Accept: "application/json; charset=utf-8",
                Authorization: "" + userToken
            },
            url:URL,
            type:"post",
            success:function(data){
                loading("0","");
                console.log(data);
                var data = data["data"];
                var str = '';
                var len = data.length;
                $.each(data,function(i,v){
                    if(i == len-1){
                        last_id = v["info"].id;
                    }
                    str +='<li class="main oh"><a href="group.html?id='+v["info"].id+'">';
                    str +='<div class="circle_center oh">';
                    str +='<div class="circle_left fl">';
                    str +='<div class="img"><img src="'+IMG_SRC+v["info"]["author"]["photo"].photo_url+'" alt="" onerror="this.src=\'images/photo.png\'" /></div>';
                    str +='<div class="name">'+v["info"]["author"].nickname+'</div>';
                    str +='<div class="lord">圈主</div>';
                    str +='</div>';
                    str +='<div class="circle_right">';
                    str +='<p class="tit">'+v["info"].title+'</p>';
                    str +='<p class="time"><span class="mr10">'+v["info"].created_at.split(" ")[0]+'</span><span>'+v["member_total"]+'人</span></p>';

                    if(v["latest_timeline"].content){
                        str +='<p class="txt">'+v["latest_timeline"].content+'</p>';
                    }else{
                        str +='<p class="txt">'+v["info"].content+'</p>';
                    }

                    str +='</div>';
                    str +='</div>';
                    str +='</a>';
                    str +='</li>';
                });
                if(state == 0){
                    $("#data_circle_list").html(str);
                }else{
                    $("#data_circle_list").append(str);
                }
            },
            error:function(err){
                loading("0","");
                console.log(err);
            }

        });
    }

    //    点击刷新更多
    $(".loadMore").click(function(){
        console.log(last_id);
        circleLoad("1",last_id);
    })
</script>
</body>
</html>